let cntNoLeaks=24,leaksToggle=document.getElementById("lks"),spoilersToggle=document.getElementById("spl"),versionNum=null,chartScoreNum=null,currNumberFormat=null,menuIsOpen=!1,versionSelectorIsOpen=!1,chartIsOpen=!1,versionData=null,enemyData=null,hpChart=null,buffNames=null,buffDescs=null,versionDazeMult=null,versionAnomMult=null,versionEnemies=null,versionIDs=[],hpData=[],elementsData=["ice","fire","electric","ether","physical"];async function loadDeadlyPage(){versionData=await(await fetch("da-versions.json")).json(),enemyData=await(await fetch("../assets/enemies.json")).json(),buffDescs=await(await fetch("../assets/buffs.json")).json(),versionIDs=Object.keys(versionData),buildHPData(),loadSavedState(),await showVersion(),displayHPChart(),updateNumberFormat()}function buildHPData(){hpData=Array.from({length:4},()=>Array.from({length:versionIDs.length}).fill(null));for(let e=1;e<=versionIDs.length;++e){let t=0,n=0;versionEnemies=versionData[versionIDs[e-1]].versionEnemies;for(let e=1;e<=3;++e){let s=versionEnemies[e-1],a=s.id,o=enemyData[a],l=s.hp,r=o.tags;t+=l,r.length>=1&&(1!=r.length||!r.includes("spoiler"))?r.includes("miasma")?n+=.97*l:r.includes("ucc")&&(n+=.964*l):n+=l}hpData[0][e-1]=Math.ceil(.281083138*t),hpData[1][e-1]=Math.ceil(t),hpData[2][e-1]=Math.ceil(.281083138*n),hpData[3][e-1]=Math.ceil(n)}}async function showVersion(){let e=versionData[versionIDs[versionNum-1]];versionDazeMult=e.versionDazeMult,versionAnomMult=e.versionAnomMult,versionEnemies=e.versionEnemies,buffNames=e.buffNames,document.getElementById("v-name").innerHTML=e.versionName,document.getElementById("v-time").innerHTML=e.versionTime,showBuffs(),showEnemies()}async function changeVersion(e){let t=leaksToggle.checked?versionIDs.length:cntNoLeaks;versionNum=(versionNum-1+e+t)%t+1,await showVersion()}function showBuffs(){for(let e=1;e<=3;++e)document.getElementById(`b-img${e}`).src=`../assets/buffs/${buffNames[e-1].toLowerCase().replace(" ","-").replace(" ","-")}.webp`,document.getElementById(`b-name${e}`).innerHTML=buffNames[e-1],document.getElementById(`b-desc${e}`).innerHTML=8==versionNum&&"Blazing Chill"==buffNames[e-1]?"• Agent <span style='color:#ff5521;font-weight:bold;'>Fire Anomaly Buildup Rate</span> and <span style='color:#98eff0;font-weight:bold;'>Ice Anomaly Buildup Rate</span> increase by <span style='color:#2bad00;font-weight:bold;'>20%</span>, and ATK increases by <span style='color:#2bad00;font-weight:bold;'>25%</span>.<br>• When inflicting an <span style='color:#7e50bb;font-weight:bold;'>Attribute Anomaly</span> on enemies, the Agent restores <span style='color:#2bad00;font-weight:bold;'>400</span> Decibels and <span style='color:#7e50bb;font-weight:bold;'>Anomaly Proficiency</span> is increased by <span style='color:#2bad00;font-weight:bold;'>80</span>, lasting 15s. Decibels recovery can be triggered once every 15s.":buffDescs[buffNames[e-1]]}function showEnemies(){let e=document.querySelector("#s1"),t=document.querySelector("#s2"),n=document.querySelector("#s3");e.innerHTML="",t.innerHTML="",n.innerHTML="";for(let s=1;s<=3;++s){let a=1==s?e:2==s?t:n,o=document.createElement("div");o.className="s-header",o.innerHTML=`Side ${s} Lv70`;let l=document.createElement("div");l.className="s-hp-daze-anom-mult",l.innerHTML=`⇧ HP: <span style="color:#ff5555;">SOON™</span> | Daze: <span style="color:#ffe599;">${versionDazeMult}%</span> | Anom: <span style="color:#7e50bb;">${versionAnomMult}%</span>`,o.appendChild(l),a.appendChild(o);let r=versionEnemies[s-1],i=r.id,c=r.type,d=enemyData[i],m=d.tags,p=d.mods,u=spoilersToggle.checked||!m.includes("spoiler"),h=u?d.name:"SPOILER BOSS",g=u?`../assets/enemies/${d.image}.webp`:"../assets/enemies/doppelganger-i.webp",f=r.hp,b=d.baseDef/50*794,y=2.35*d.baseDaze,v=d.stunMult,D=d.stunTime,I=d.baseAnom,N=d.elementMult,E=document.createElement("div");E.className="e";let w=document.createElement("img"),k=document.createElement("div"),S=document.createElement("div");w.className="e-img",k.className="e-name",S.className="e-hover",w.src=g,S.appendChild(w),k.innerHTML=h,S.appendChild(k),E.appendChild(S);let L=document.createElement("div");L.className="wr",generateWR(N,L),E.appendChild(L);let C=document.createElement("div");if(C.className="e-hp",C.innerHTML=numberFormat(f),m.length>=1&&(1!=m.length||!m.includes("spoiler"))){let e=document.createElement("div");e.className="tt-e-hp",m.includes("ucc")&&(e.innerHTML=`<span style="color:#ecce45;">✦</span><span class="tt-text">${instant("#ecce45","IMPAIRED!!",h,f,1.2,3)}</span>`),m.includes("miasma")&&(e.innerHTML=`<span style="color:#d4317b;">✦</span><span class="tt-text">${instant("#d4317b","PURIFIED!!",h,f,3,1)}</span>`),C.appendChild(e)}E.appendChild(C);let M=document.createElement("div");M.className="e-def",M.innerHTML=Math.ceil(b),E.appendChild(M);let T=document.createElement("div");T.className="tt-e-stat",T.innerHTML=`+</span><span class="tt-text">${generateEnemyStats(y,v,D,versionAnomMult/100*I,N,p)}</span>`,E.appendChild(T),a.appendChild(E);let H=document.createElement("div");H.className="esd",H.innerHTML=m.includes("spoiler")&&!spoilersToggle.checked?`${d.spoilerDesc}<br><br>${d.spoilerPerf}`:"2"==i[0]?`${d.desc}<br><br>${d.perf}`:`${d.desc[c]}<br><br>${d.perf[c]}`,H.innerHTML+=""+(1==c||"14403"==i&&4==versionNum?`<br><br>${d.misc}`:""),a.appendChild(H)}document.getElementById("v-hp-raw-20000").innerHTML=numberFormat(hpData[0][versionNum-1]),document.getElementById("v-hp-raw-60000").innerHTML=numberFormat(hpData[1][versionNum-1]),document.getElementById("v-hp-alt-20000").innerHTML=numberFormat(hpData[2][versionNum-1]),document.getElementById("v-hp-alt-60000").innerHTML=numberFormat(hpData[3][versionNum-1]),saveProgress()}function generateWR(e,t){let n=document.createElement("img"),s=document.createElement("img"),a=document.createElement("img"),o=document.createElement("img");n.className="wk",s.className="wk",a.className="res",o.className="res",n.src="../assets/elements/none.webp",s.src="../assets/elements/none.webp",a.src="../assets/elements/none.webp",o.src="../assets/elements/none.webp";let l=0,r=0;for(let t=0;t<5;++t)e[t]<1&&0==l?(n.src=`../assets/elements/${elementsData[t]}.webp`,++l):e[t]<1&&1==l?s.src=`../assets/elements/${elementsData[t]}.webp`:e[t]>1&&0==r?(a.src=`../assets/elements/${elementsData[t]}.webp`,++r):e[t]>1&&1==r&&(o.src=`../assets/elements/${elementsData[t]}.webp`);t.appendChild(n),t.appendChild(s),t.appendChild(a),t.appendChild(o)}function instant(e,t,n,s,a,o){return`<span style="font-weight:bold;text-decoration:underline;">${n}</span><br>\n<span style="color:#f6b26b;font-weight:bold;">Alt HP</span>: <span style="color:${e};font-weight:bold;">${numberFormat(Math.ceil(s*(100-a*o)/100))}</span><br>\n<span style="font-weight:bold;">(assume ${100-a*o}% of HP)</span><br><br>\n<span style="font-weight:bold;"><span style="color:${e};">${t}</span></span> ${o} time(s)`+("Unknown Corruption Complex"==n?" on<br>legs, 3 time(s) on core":"")}function generateEnemyStats(e,t,n,s,a,o){let l=[1,1,1,1,1.2],r=["#98eff0","#ff5521","#2eb6ff","#fe437e","#f0d12b"],i=`<span style="font-weight:bold;">Max Daze: <span style="color:#ffe599;">${Math.round(1e4*e)/1e4}</span></span><br>\n(<span style="color:#ffe599;font-weight:bold;">${t}%</span> DMG for <span style="color:#ffe599;font-weight:bold;">${n}s</span>)<br><br>`;if(o.includes("no-anom"))return i+'<span style="font-weight:bold;">IMMUNE TO ANOMALY</span>';i+='<span style="font-weight:bold;">Max Anomaly Buildup:</span><br>';for(let e=0;e<5;++e)i+=`<span style="color:${r[e]};font-weight:bold;">${Math.round(s*l[e]*a[e]*100)/100}</span>/`;return i=i.slice(0,-1)+"<br>"+(o.includes("no-freeze")?'<span style="color:#98eff0;font-weight:bold;">UNFREEZABLE</span>':""),i}function loadSavedState(){"true"==localStorage.getItem("leaksEnabled")&&(leaksToggle.checked=!0),"true"==localStorage.getItem("spoilersEnabled")&&(spoilersToggle.checked=!0),versionNum=parseInt(localStorage.getItem("lastDAVersion")||`${cntNoLeaks}`),chartScoreNum=localStorage.getItem("lastDAChartScore")||"60k",currNumberFormat=localStorage.getItem("numberFormat")||"period",leaksToggle.checked||(versionNum=Math.min(versionNum,cntNoLeaks)),saveProgress()}function saveProgress(){localStorage.setItem("lastDAVersion",versionNum),localStorage.setItem("lastDAChartScore",chartScoreNum),localStorage.setItem("numberFormat",currNumberFormat),localStorage.setItem("leaksEnabled",leaksToggle.checked),localStorage.setItem("spoilersEnabled",spoilersToggle.checked)}function toggleMenu(){let e=document.getElementById("mb"),t=document.getElementById("mb-o"),n=document.getElementById("open-mb-btn");menuIsOpen?(document.body.classList.remove("no-scroll"),e.style.display="none",t.style.display="none",n.style.display="none"):(document.body.classList.add("no-scroll"),e.style.display="block",t.style.display="block",n.style.display="block"),menuIsOpen=!menuIsOpen}function updateNumberFormat(e){e&&(currNumberFormat=e.dataset.format);let t=document.getElementById("ex-num"),n=document.querySelectorAll(".nfb");t.innerHTML=numberFormat(2222222),n.forEach(e=>e.classList.toggle("selected",e.dataset.format==currNumberFormat)),showEnemies(),displayHPChart()}function numberFormat(e){return"comma"==currNumberFormat?e.toLocaleString("en-US"):"period"==currNumberFormat?e.toLocaleString("de-DE"):e}function toggleVersionSelector(){let e=document.getElementById("vs"),t=document.getElementById("vs-o");versionSelectorIsOpen?(document.body.classList.remove("no-scroll"),e.style.display="none",t.style.display="none"):(document.body.classList.add("no-scroll"),e.style.display="flex",t.style.display="block",displayVersionSelectorGrid()),versionSelectorIsOpen=!versionSelectorIsOpen}function displayVersionSelectorGrid(){let e=document.getElementById("vs").querySelector("#vg");e.innerHTML="";for(let t=1;t<=(leaksToggle.checked?versionIDs.length:cntNoLeaks);++t){let n=versionData[versionIDs[t-1]],s=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div");s.className="vg-c",a.className="vg-c-name",o.className="vg-c-time",a.innerHTML=n.versionName,o.innerHTML=n.versionTime,s.appendChild(a),s.appendChild(o),s.onclick=()=>{versionNum=t,toggleVersionSelector(),showVersion()},e.appendChild(s)}}function toggleChart(){let e=document.getElementById("c");chartIsOpen?(document.body.classList.remove("no-scroll"),e.style.display="none"):(document.body.classList.add("no-scroll"),e.style.display="flex"),chartIsOpen=!chartIsOpen}function toggleChartPoints(e){chartScoreNum!=e&&(chartScoreNum=e,saveProgress(),displayHPChart())}function downloadChart(){let e=document.createElement("a");e.href=hpChart.toBase64Image("image/png",1),e.download=`Deadly Assault HP (${chartScoreNum})`,e.click()}function createHPDataset(e,t,n){return{label:e,data:t,pointRadius:2,borderWidth:2,borderColor:n,pointHoverRadius:4,pointHoverBorderWidth:2,pointHoverBorderColor:n,backgroundColor:"#ffffff"}}function displayHPChart(){document.querySelectorAll(".c-k").forEach(e=>e.classList.toggle("selected",e.dataset.format==chartScoreNum));const e={id:"verticalHoverLine",beforeDatasetsDraw(e,t,n){let{ctx:s,chartArea:{top:a,bottom:o,height:l}}=e;s.save();for(let t=0;t<=2;++t)e.getDatasetMeta(t).data.forEach((e,t)=>{e.active&&(s.beginPath(),s.strokeStyle="#888888",s.setLineDash([4,6]),s.moveTo(e.x,a),s.lineTo(e.x,o),s.stroke())});s.restore()}},t={id:"legendPadding",beforeInit(e){let t=e.legend.fit;e.legend.fit=function(){t.bind(e.legend)(),e.legend.height+=15}}},n={id:"hideTooltipOutside",afterEvent(e,t){let{top:n,bottom:s,left:a,right:o}=e.chartArea,{x:l,y:r}=t.event;(l<a||l>o||r<n||r>s)&&(e.tooltip.setActiveElements([]),e.tooltip.update(),e.setActiveElements([]),e.update())}};Chart.Tooltip.positioners.cursor=function(e,t){if(!t)return!1;let{top:n,bottom:s}=this.chart.chartArea,{x:a,y:o}=t;return o+=o<=(n+s)/3?50:-50,{x:a,y:o}},hpChart||(hpChart=new Chart("hpChart",{type:"line",plugins:[e,t,n],options:{animation:!1,responsive:!0,maintainAspectRatio:!1,interaction:{mode:"nearest",axis:"x",intersect:!1},layout:{padding:{top:10,bottom:15,left:10,right:25}},scales:{x:{offset:!0,border:{display:!1},grid:{color:"transparent"},ticks:{padding:10,font:{family:"Inconsolata",size:12},color:"#888888",maxRotation:0,callback:function(e,t){return t%2==0?this.getLabelForValue(e):""}}},y:{border:{display:!1},grid:{color:function(e){return e.tick.value%4e7==0?"#888888":"#444444"}},ticks:{padding:15,font:{family:"Inconsolata",size:12},color:"#888888",stepSize:2e7,callback:function(e,t){return t%2==0?numberFormat(e):""}}}},plugins:{title:{display:!0,color:"#ffffff",font:{family:"Inconsolata",size:20,weight:"bold"}},legend:{labels:{usePointStyle:!0,boxHeight:8,font:{family:"Inconsolata",size:14},generateLabels:function(e){let t=Chart.defaults.plugins.legend.labels.generateLabels(e);return t.forEach((t,n)=>{e.isDatasetVisible(n)?t.fontColor=e.data.datasets[t.datasetIndex].borderColor:(t.fontColor="#888888",t.strokeStyle="#888888")}),t}}},tooltip:{usePointStyle:!0,boxHeight:8,position:"cursor",caretSize:0,titleFont:{family:"Inconsolata",size:12,weight:"bold",lineHeight:.75},bodyFont:{family:"Inconsolata",size:12},callbacks:{labelTextColor:function(e){return e.dataset.borderColor},label:function(e){return e.dataset.label+": "+numberFormat(e.parsed.y)}}}}}})),hpChart.data.labels=versionIDs,hpChart.data.datasets=[createHPDataset("Raw HP","20k"==chartScoreNum?hpData[0]:hpData[1],"#e06666"),createHPDataset("Alt HP","20k"==chartScoreNum?hpData[2]:hpData[3],"#f6b26b")],hpChart.options.scales.y.min="20k"==chartScoreNum?4e7:16e7,hpChart.options.scales.y.max="20k"==chartScoreNum?16e7:48e7,hpChart.options.plugins.title.text=`Deadly Assault HP (${chartScoreNum})`,hpChart.update(),saveProgress()}document.addEventListener("keydown",e=>{e.stopPropagation(),"Escape"==e.key?(e.preventDefault(),chartIsOpen?toggleChart():versionSelectorIsOpen?toggleVersionSelector():toggleMenu()):" "!=e.key||menuIsOpen||chartIsOpen?"Backspace"!=e.key||menuIsOpen||versionSelectorIsOpen?"ArrowLeft"!=e.key||menuIsOpen||chartIsOpen||versionSelectorIsOpen?"ArrowRight"!=e.key||menuIsOpen||chartIsOpen||versionSelectorIsOpen?("ArrowUp"==e.key||"ArrowDown"==e.key)&&e.preventDefault():(e.preventDefault(),changeVersion(1)):(e.preventDefault(),changeVersion(-1)):(e.preventDefault(),toggleChart()):(e.preventDefault(),toggleVersionSelector())}),leaksToggle.addEventListener("change",()=>{leaksToggle.checked||(spoilersToggle.checked=!1,versionNum>cntNoLeaks&&(versionNum=cntNoLeaks)),showVersion()}),spoilersToggle.addEventListener("change",()=>{spoilersToggle.checked&&(leaksToggle.checked=!0),showEnemies()}),window.addEventListener("DOMContentLoaded",async()=>{await loadDeadlyPage()});