let oldVersionNum,currVersion,versionNum,nodeNum,chartNodeNum,oldChartDisplayType,chartDisplayType,currNumberFormat,versionData,versionDazeMult,versionAnomMult,versionEnemies,enemyData,hpChart,cntNoLeaks=41,oldModeNum=4,modeNum=4,v25=38,leaksToggle=document.getElementById("lks"),spoilersToggle=document.getElementById("spl"),chartDropdown=document.getElementById("c-dd"),menuIsOpen=versionSelectorIsOpen=chartIsOpen=!1,versionIDs=hpData=[],nodeLvlData=[],stableNodeLvlData=[25,28,30,33,35,38,40,43,45,50],disputedNodeLvlData=[40,43,45,48,50,53,55,60],ambushNodeLvlData=[50,53,55,60,65],pre25CriticalNodeLvlData=[50,53,55,58,60,65,70],post25CriticalNodeLvlData=[50,55,60,65,70],nodeHPMult=[100,116,135,157,181,193,206,220,235,271,291,314,338,364,419,431,444,458,472,543,618,703,801,912,1049,1134,1227,1328,1437,1653,1792,1942,2106,2283,2626,2865,3126,3411,3722,4281,4717,5197,5727,6311,7258,7691,8151,8637,9153,10527,11227,11975,12772,13623,15667,15957,16252,16553,16860,19389,19716,20049,20387,20731,21081,21437,21799,22167,22541,24795],nodeDefMult=[100,108,116,124,132,142,152,164,176,188,200,214,228,242,258,274,290,306,324,344,362,382,402,422,444,466,490,512,536,562,586,612,638,666,694,722,750,780,810,842,872,904,938,970,1004,1038,1074,1110,1146,1184,1220,1258,1298,1338,1378,1418,1460,1502,1544,1588,1588,1588,1588,1588,1588,1588,1588,1588,1588,1588],nodeDazeMult=[100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,101,102,103,104,104,105,106,107,108,110,113,115,118,120,123,125,128,130,133,137,142,146,151,155,160,164,169,173,178,180,183,186,189,192,195,197,200,203,206,209,212,215,217,220,223,226,229,232,235],elementsData=["ice","fire","electric","ether","physical"];async function loadShiyuPage(){versionData=await(await fetch("sd-versions.json")).json(),enemyData=await(await fetch("../assets/enemies.json")).json();for(let e=1;e<=4;++e)versionIDs.push(Object.keys(versionData[e-1].versions));buildHPData(),loadSavedState(),await showVersion(),showNode(),showChartNode(),updateNumberFormat()}function buildHPData(){hpData=[Array.from({length:10},()=>Array.from({length:3},()=>Array.from({length:1}).fill(null))),Array.from({length:8},()=>Array.from({length:3},()=>Array.from({length:1}).fill(null))),Array.from({length:5},()=>Array.from({length:3},()=>Array.from({length:1}).fill(null))),Array.from({length:7},()=>Array.from({length:3},()=>Array.from({length:versionIDs[3].length}).fill(null)))];for(let e=1;e<=4;++e)for(let t=1;t<=versionIDs[e-1].length;++t){nodeLvlData=1==e?stableNodeLvlData:2==e?disputedNodeLvlData:3==e?ambushNodeLvlData:t<v25?pre25CriticalNodeLvlData:post25CriticalNodeLvlData,versionEnemies=versionData[e-1].versions[versionIDs[e-1][t-1]].versionEnemies;for(let n=1;n<=versionEnemies.nodes.length;++n){let o=versionEnemies.nodes[n-1],a=aoeHP=altHP=0,s=!0;for(let e=1;e<=o.sides.length;++e){let t=o.sides[e-1];if(null==t)continue;let l=t.sideHPMult;for(let e=1;e<=t.waves.length;++e){let o=t.waves[e-1];for(let e=1;e<=o.enemies.length;++e){let t=o.enemies[e-1],r=enemyData[t.id],i=Math.round(l*r.baseHP[t.type]*nodeHPMult[nodeLvlData[n-1]-1]/1e4),d=r.tags;for(let e=1;e<=t.count;++e)a+="14000"!=t.id?i:1,aoeHP+=s?i:0,altHP+=i,d.length>=1&&(1!=d.length||!d.includes("spoiler")&&!d.includes("hitch"))?(d.includes("palicus")&&(altHP-=.25*i),d.includes("robot")&&(altHP-=.1*i),d.includes("brute")&&(altHP-=.08*i),d.includes("miasma")&&(altHP-=i*("26202"==t.id?.3:.15))):altHP-=s?0:i,s=!1}s=!0}}hpData[e-1][n-1][0][t-1]=a,hpData[e-1][n-1][1][t-1]=aoeHP,hpData[e-1][n-1][2][t-1]=4==e&&(t<v25?n>5:n>3)||3!=e?Math.ceil(altHP):null}}}async function showVersion(){currVersion=versionData[modeNum-1].versions[versionIDs[modeNum-1][versionNum-1]],versionDazeMult=currVersion.versionDazeMult,versionAnomMult=currVersion.versionAnomMult,versionEnemies=currVersion.versionEnemies,document.getElementById("v-name").innerHTML=currVersion.versionName+(4==modeNum&&versionNum==cntNoLeaks?"<span style='color:#ff0000;font-weight:bold;'> (LIVE)</span>":""),document.getElementById("v-time").innerHTML=currVersion.versionTime,showNode()}async function changeVersion(e){let t=parseInt(localStorage.getItem("lastSDVersion")),n=leaksToggle.checked?versionIDs[modeNum-1].length:cntNoLeaks;4==modeNum?versionNum=(versionNum-1+e+n)%n+1:(modeNum=4,versionNum=!leaksToggle.checked&&t>cntNoLeaks?cntNoLeaks:t),await showVersion()}function showNode(){oldModeNum!=modeNum&&(nodeNum=4==modeNum?parseInt(localStorage.getItem("lastSDNode")):versionEnemies.nodes.length,oldModeNum=modeNum,displayHPChart()),4==modeNum&&changePrePostNode(),nodeLvlData=1==modeNum?stableNodeLvlData:2==modeNum?disputedNodeLvlData:3==modeNum?ambushNodeLvlData:versionNum<v25?pre25CriticalNodeLvlData:post25CriticalNodeLvlData,document.getElementById("n-text").innerHTML=nodeNum,showBuffs(),showEnemies()}function changeNode(e){nodeNum=(nodeNum-1+e+versionEnemies.nodes.length)%versionEnemies.nodes.length+1,showNode()}function changePrePostNode(){oldVersionNum<v25&&versionNum>=v25?nodeNum<=2?nodeNum=1:nodeNum<=4?nodeNum=2:nodeNum-=2:oldVersionNum>=v25&&versionNum<v25&&(nodeNum>=3?nodeNum+=2:2==nodeNum&&(nodeNum=3)),oldVersionNum=versionNum}function showChartNode(){displayHPChart()}function changeChartNode(e){if(4!=modeNum)return;let t="Pre 2.5"==chartDisplayType?7:5;chartNodeNum=(chartNodeNum-1+e+t)%t+1,showChartNode()}function changePrePostChartNode(){oldChartDisplayType!=chartDisplayType&&("Pre 2.5"==chartDisplayType?chartNodeNum>=3?chartNodeNum+=2:2==chartNodeNum&&(chartNodeNum=3):chartNodeNum<=2?chartNodeNum=1:chartNodeNum<=4?chartNodeNum=2:chartNodeNum-=2),oldChartDisplayType=chartDisplayType}function changeChart(){displayHPChart()}function showBuffs(){if(4!=modeNum)document.getElementById("b-name").innerHTML=versionEnemies.nodes[nodeNum-1].buffName,document.getElementById("b-desc").innerHTML=versionEnemies.nodes[nodeNum-1].buffDesc;else if(versionNum>=v25)if(5==nodeNum)for(let e=1;e<=3;++e)document.getElementById(`b-name${e}`).innerHTML=currVersion.buffName[e-1],document.getElementById(`b-desc${e}`).innerHTML=currVersion.buffDesc[e-1];else{let e=currVersion.mainBuffNum;document.getElementById("b-name").innerHTML=currVersion.buffName[e-1],document.getElementById("b-desc").innerHTML=currVersion.buffDesc[e-1]}else document.getElementById("b-name").innerHTML=currVersion.buffName,document.getElementById("b-desc").innerHTML=currVersion.buffDesc;document.getElementById("b").style.display=versionNum>=v25&&5==nodeNum?"none":"block",document.getElementById("n5-b").style.display=versionNum>=v25&&5==nodeNum?"flex":"none"}function showEnemies(){let e=versionEnemies.nodes[nodeNum-1],t=document.querySelector("#s1"),n=document.querySelector("#s2"),o=document.querySelector("#s3"),a=4==modeNum?versionNum>=v25?nodeNum>3?"1050px":"1350px":nodeNum>5?"750px":"1350px":3==modeNum?"490px":2==modeNum||nodeNum>8?"750px":"1350px";t.style.height=n.style.height=o.style.height=a,t.innerHTML="",n.innerHTML="",o.innerHTML="",o.style.display=versionNum<v25||nodeNum<5?"none":"flex";for(let a=1;a<=e.sides.length;++a){let s=1==a?t:2==a?n:o,l=e.sides[a-1],r=document.createElement("div");r.className="s-header",r.innerHTML=`${nodeNum}-${a} Lv${nodeLvlData[nodeNum-1]}`;let i=document.createElement("div");i.className="s-hp-daze-anom-mult",i.innerHTML='HP: <span style="color:#ff5555;">N/A</span> | Daze: <span style="color:#ffe599;">N/A</span> | Anom: <span style="color:#7756c6;">N/A</span>',r.appendChild(i);let d=document.createElement("div");if(d.className="wr",generateWR(null!=l?e.sides[a-1].sideElementMult:[1,1,1,1,1],d),r.appendChild(d),s.appendChild(r),null==l)continue;let m=l.sideHPMult;i.innerHTML=`HP: <span style="color:#ff5555;">${m}%</span> | Daze: <span style="color:#ffe599;">${1==modeNum&&7==nodeNum?97:versionDazeMult}%</span> | Anom: <span style="color:#7756c6;">${versionAnomMult}%</span>`;for(let e=1;e<=l.waves.length;++e){let t=document.createElement("div");t.className="w";let n=document.createElement("div");n.className="w-num",n.innerHTML=`WAVE ${e}`,t.appendChild(n);let o=l.waves[e-1],a=document.createElement("div");a.className="w-e";for(let e=1;e<=o.enemies.length;++e){let t=o.enemies[e-1],n=t.id,s=t.type,l=enemyData[n],r=l.tags,i=l.mods,d=spoilersToggle.checked||!r.includes("spoiler"),c=d?l.name:"SPOILER ENEMY",u=d?`../assets/enemies/${l.image}.webp`:"../assets/enemies/doppelganger-i.webp",p=Math.round(m*l.baseHP[s]*nodeHPMult[nodeLvlData[nodeNum-1]-1]/1e4),h=l.baseDef*nodeDefMult[nodeLvlData[nodeNum-1]-1]/100,N=l.baseDaze[s]*nodeDazeMult[nodeLvlData[nodeNum-1]-1]/100*(1==modeNum&&7==nodeNum?.97:1),g=l.stunMult,f=l.stunTime,y=l.baseAnom,v=l.elementMult;for(let e=1;e<=t.count;++e){let e=document.createElement("div");e.className="e";let t=document.createElement("img"),o=document.createElement("div"),s=document.createElement("div");t.className="e-img",o.className="e-name",s.className="e-hover",t.src=u,s.appendChild(t),o.innerHTML=c,s.appendChild(o),e.appendChild(s);let l=document.createElement("div");l.className="wr",generateWR(v,l),e.appendChild(l);let d=document.createElement("div");if(d.className="e-hp",d.innerHTML=numberFormat(p),r.length>=1&&(1!=r.length||!r.includes("spoiler"))){let e=document.createElement("div");if(e.className="tt-e-hp",r.includes("hitch"))e.innerHTML=hitch(p)+"<br>",d.innerHTML=numberFormat(1);else{let t=p,o="#ffffff";r.includes("palicus")&&(t-=.25*p,o="#93c47d",e.innerHTML+=palicus(t)+"<br>"),r.includes("robot")&&(t-=.1*p,o="#ca9a00",e.innerHTML+=instant(o,"IMPAIRED!!",2)+"<br>"),r.includes("brute")&&(t-=.08*p,o="#ca9a00",e.innerHTML+=instant(o,"IMPAIRED!!",1)+"<br>"),r.includes("miasma")&&(t-=p*("26202"==n?.3:.15),o="#b4317b",e.innerHTML+=instant(o,"PURIFIED!!","26202"==n?2:1)+"<br>"),e.innerHTML=alt(o,c,t,p)+e.innerHTML}d.appendChild(e)}e.appendChild(d);let m=document.createElement("div");m.className="e-def",m.innerHTML=Math.ceil(h),e.appendChild(m);let b=document.createElement("div");b.className="tt-e-stat",b.innerHTML=`+<span class="tt-text">${generateEnemyStats(versionDazeMult/100*N,g,f,y,v,i)}</span>`,e.appendChild(b),a.appendChild(e)}}t.appendChild(a),s.appendChild(t)}}document.getElementById("n-hp-raw").innerHTML=numberFormat(hpData[modeNum-1][nodeNum-1][0][versionNum-1]),document.getElementById("n-hp-aoe").innerHTML=numberFormat(hpData[modeNum-1][nodeNum-1][1][versionNum-1]),document.getElementById("n-hp-alt").innerHTML=1==modeNum||2==modeNum||4==modeNum&&(v<v25?nodeNum>5:nodeNum>3)?numberFormat(hpData[modeNum-1][nodeNum-1][2][versionNum-1]):numberFormat(hpData[modeNum-1][nodeNum-1][1][versionNum-1]),4==modeNum&&saveLastPage(),saveSettings()}function generateWR(e,t){let n=document.createElement("img"),o=document.createElement("img"),a=document.createElement("img"),s=document.createElement("img");n.className="wk",o.className="wk",a.className="res",s.className="res",n.src="../assets/elements/none.webp",o.src="../assets/elements/none.webp",a.src="../assets/elements/none.webp",s.src="../assets/elements/none.webp";let l=resCnt=0;for(let t=0;t<5;++t)e[t]<1&&0==l?(n.src=`../assets/elements/${elementsData[t]}.webp`,++l):e[t]<1&&1==l?o.src=`../assets/elements/${elementsData[t]}.webp`:e[t]>1&&0==resCnt?(a.src=`../assets/elements/${elementsData[t]}.webp`,++resCnt):e[t]>1&&1==resCnt&&(s.src=`../assets/elements/${elementsData[t]}.webp`);t.appendChild(n),t.appendChild(o),t.appendChild(a),t.appendChild(s)}function alt(e,t,n,o){return`<span style="color:${e};">✦</span><span class="tt-text">\n<span style="font-weight:bold;text-decoration:underline;">${t}</span><br>\n<span style="color:#f6b26b;font-weight:bold;">Alt HP</span>: <span style="color:${e};font-weight:bold;">${numberFormat(Math.ceil(n))}</span><br>\n<span style="font-weight:bold;">(assume ${Math.round(n/o*1e3)/10}% of HP)</span><br><br>`}function hitch(e){return`<span style="color:#ffffff;">✦</span><span class="tt-text">\n<span style="font-weight:bold;text-decoration:underline;">Hitchspiker</span><br>\nTrue <span style="color:#ff5555;font-weight:bold;">Raw HP</span>: <span style="color:#ff5555;font-weight:bold;">${numberFormat(e)}</span><br><br>\ntechnically doesn't<br>need to be killed</span>`}function palicus(){return"hit both 50% of the time</span>"}function instant(e,t,n){return`<span style="font-weight:bold;"><span style="color:${e};">${t}</span></span> ${n} time(s)</span>`}function generateEnemyStats(e,t,n,o,a,s){let l=[1,1,1,1,1.2],r=["#98eff0","#ff5521","#2eb6ff","#fe437e","#f0d12b"],i=`<span style="font-weight:bold;">Max Daze: <span style="color:#ffe599;">${Math.round(1e4*e)/1e4}</span></span><br>\n(<span style="color:#ffe599;font-weight:bold;">${t}%</span> DMG for <span style="color:#ffe599;font-weight:bold;">${n}s</span>)<br><br>`;if(s.includes("no-anom"))return i+'<span style="font-weight:bold;">IMMUNE TO ANOMALY</span>';i+='<span style="font-weight:bold;">Max Anomaly Buildup:</span><br>';for(let e=0;e<5;++e)i+=`<span style="color:${r[e]};font-weight:bold;">${Math.round(o*l[e]*a[e]*100)/100}</span>/`;return i=i.slice(0,-1)+"<br>"+(s.includes("no-freeze")?'<span style="color:#98eff0;font-weight:bold;">UNFREEZABLE</span>':""),i}function loadSavedState(){"true"==localStorage.getItem("leaksEnabled")&&(leaksToggle.checked=!0),"true"==localStorage.getItem("spoilersEnabled")&&(spoilersToggle.checked=!0),versionNum=parseInt(localStorage.getItem("lastSDVersion")||`${cntNoLeaks}`),oldVersionNum=versionNum,nodeNum=parseInt(localStorage.getItem("lastSDNode")||"7"),chartNodeNum=parseInt(localStorage.getItem("lastSDChartNode")||"7"),chartDisplayType=localStorage.getItem("lastSDChartType")||"Pre 2.5",oldChartDisplayType=chartDisplayType,chartDropdown.value=chartDisplayType,currNumberFormat=localStorage.getItem("numberFormat")||"period",leaksToggle.checked||(versionNum=Math.min(versionNum,cntNoLeaks)),saveLastPage(),saveSettings()}function saveLastPage(){localStorage.setItem("lastSDVersion",versionNum),localStorage.setItem("lastSDNode",nodeNum),localStorage.setItem("lastSDChartNode",chartNodeNum),localStorage.setItem("lastSDChartType",chartDisplayType)}function saveSettings(){localStorage.setItem("numberFormat",currNumberFormat),localStorage.setItem("leaksEnabled",leaksToggle.checked),localStorage.setItem("spoilersEnabled",spoilersToggle.checked)}function toggleMenu(){let e=document.getElementById("mb"),t=document.getElementById("mb-o"),n=document.getElementById("open-mb-btn");menuIsOpen?(document.body.classList.remove("no-scroll"),e.style.display="none",t.style.display="none",n.style.display="none"):(document.body.classList.add("no-scroll"),e.style.display="block",t.style.display="block",n.style.display="block"),menuIsOpen=!menuIsOpen}function updateNumberFormat(e){e&&(currNumberFormat=e.dataset.format);let t=document.getElementById("ex-num"),n=document.querySelectorAll(".nfb");t.innerHTML=numberFormat(2222222),n.forEach(e=>e.classList.toggle("selected",e.dataset.format==currNumberFormat)),showNode(),displayHPChart()}function numberFormat(e){return"comma"==currNumberFormat?e.toLocaleString("en-US"):"period"==currNumberFormat?e.toLocaleString("de-DE"):e}function toggleVersionSelector(){let e=document.getElementById("vs"),t=document.getElementById("vs-o");versionSelectorIsOpen?(document.body.classList.remove("no-scroll"),e.style.display="none",t.style.display="none"):(document.body.classList.add("no-scroll"),e.style.display="flex",t.style.display="block",displayVersionSelectorGrid()),versionSelectorIsOpen=!versionSelectorIsOpen}function displayVersionSelectorGrid(){let e=document.getElementById("vs"),t=e.querySelector("#vg"),n=e.querySelector("#vg-misc"),o=e.querySelector("#vg-title"),a=e.querySelector("#vg-crit");n.innerHTML="",o.innerHTML="Critical Node",a.innerHTML="";for(let e=1;e<=4;++e)for(let t=1;t<=(4==e?leaksToggle.checked?versionIDs[e-1].length:cntNoLeaks:1);++t){let o=versionData[e-1].versions[versionIDs[e-1][t-1]],s=document.createElement("div"),l=document.createElement("div"),r=document.createElement("div");s.className="vg-c",l.className="vg-c-name",r.className="vg-c-time",l.innerHTML=o.versionName+(4==e&&t==cntNoLeaks?"<span style='color:#ff0000;font-weight:bold;'> (LIVE)</span>":""),r.innerHTML=o.versionTime,s.appendChild(l),s.appendChild(r),s.onclick=()=>{modeNum=e,versionNum=4==modeNum?t:1,toggleVersionSelector(),showVersion()},4!=e?n.appendChild(s):a.appendChild(s)}t.appendChild(n),t.appendChild(o),t.appendChild(a)}function toggleChart(){let e=document.getElementById("c");chartIsOpen?(document.body.classList.remove("no-scroll"),e.style.display="none"):(document.body.classList.add("no-scroll"),e.style.display="flex"),chartIsOpen=!chartIsOpen}function downloadChart(){let e=document.createElement("a");e.href=hpChart.toBase64Image("image/png",1),e.download=`Shiyu Defense - ${versionData[modeNum-1].name} `+(4==modeNum?`${chartNodeNum} HP`:"HP"),e.click()}function createHPDataset(e,t,n){return{label:e,data:t,pointRadius:2,borderWidth:2,borderColor:n,pointHoverRadius:4,pointHoverBorderWidth:2,pointHoverBorderColor:n,backgroundColor:"#ffffff"}}function displayHPChart(){chartDisplayType=chartDropdown.value,4==modeNum&&changePrePostChartNode();let e="Pre 2.5"==chartDisplayType?0:v25-1,t="Pre 2.5"==chartDisplayType?v25-1:versionIDs[modeNum-1].length;chartDropdown.style.display=4==modeNum?"block":"none";const n={id:"verticalHoverLine",beforeDatasetsDraw(e,t,n){let{ctx:o,chartArea:{top:a,bottom:s,height:l}}=e;o.save();for(let t=0;t<=2;++t)e.getDatasetMeta(t).data.forEach((e,t)=>{e.active&&(o.beginPath(),o.strokeStyle="#888888",o.setLineDash([4,6]),o.moveTo(e.x,a),o.lineTo(e.x,s),o.stroke())});o.restore()}},o={id:"legendPadding",beforeInit(e){let t=e.legend.fit;e.legend.fit=function(){t.bind(e.legend)(),e.legend.height+=15}}},a={id:"hideTooltipOutside",afterEvent(e,t){let{top:n,bottom:o,left:a,right:s}=e.chartArea,{x:l,y:r}=t.event;(l<a||l>s||r<n||r>o)&&(e.tooltip.setActiveElements([]),e.tooltip.update(),e.setActiveElements([]),e.update())}};Chart.Tooltip.positioners.cursor=function(e,t){if(!t)return!1;let{top:n,bottom:o}=this.chart.chartArea,{x:a,y:s}=t;return s+=s<=(n+o)/3?50:-50,{x:a,y:s}},hpChart||(hpChart=new Chart("hpChart",{type:"line",plugins:[n,o,a],options:{animation:!1,responsive:!0,maintainAspectRatio:!1,interaction:{mode:"nearest",axis:"x",intersect:!1},layout:{padding:{top:10,bottom:15,left:10,right:25}},scales:{x:{offset:!0,border:{display:!1},grid:{color:"transparent"},ticks:{padding:10,font:{family:"Inconsolata",size:12},color:"#888888",maxRotation:0,callback:function(e,t){return t%2==0?this.getLabelForValue(e):""}}},y:{border:{display:!1},ticks:{padding:15,font:{family:"Inconsolata",size:12},color:"#888888",callback:function(e,t){return t%2==0?numberFormat(e):""}}}},plugins:{title:{display:!0,color:"#ffffff",font:{family:"Inconsolata",size:20,weight:"bold"}},legend:{labels:{usePointStyle:!0,boxHeight:8,font:{family:"Inconsolata",size:14},generateLabels:function(e){let t=Chart.defaults.plugins.legend.labels.generateLabels(e);return t.forEach((t,n)=>{e.isDatasetVisible(n)?t.fontColor=e.data.datasets[t.datasetIndex].borderColor:(t.fontColor="#888888",t.strokeStyle="#888888")}),t}}},tooltip:{usePointStyle:!0,boxHeight:8,position:"cursor",caretSize:0,titleFont:{family:"Inconsolata",size:12,weight:"bold",lineHeight:.75},bodyFont:{family:"Inconsolata",size:12},callbacks:{labelTextColor:function(e){return e.dataset.borderColor},label:function(e){return e.dataset.label+": "+numberFormat(e.parsed.y)}}}}}}));let s=rawHPData=aoeHPData=altHPData=[];if(4!=modeNum){s=Array.from({length:nodeLvlData[modeNum-1].length},(e,t)=>`${versionData[modeNum-1].name} ${t+1}`);for(let e=0;e<nodeLvlData[modeNum-1].length;++e)rawHPData.push(hpData[modeNum-1][e][0][0]),aoeHPData.push(hpData[modeNum-1][e][1][0]),altHPData.push(hpData[modeNum-1][e][2][0]);hpChart.options.plugins.title.text=`Shiyu Defense: ${versionData[modeNum-1].name} HP`,hpChart.options.scales.y.min=0,hpChart.options.scales.y.max=16e6,hpChart.options.scales.y.ticks.stepSize=2e6,hpChart.options.scales.y.grid={color:function(e){return e.tick.value%4e6==0?"#888888":"#444444"}}}else{s=versionIDs[modeNum-1].slice(e,t);let n=hpData[modeNum-1][chartNodeNum-1].map(n=>n.slice(e,t));rawHPData=n[0],aoeHPData=n[1],altHPData=n[2],hpChart.options.plugins.title.text=`Shiyu Defense: Critical Node ${chartNodeNum} HP - ${chartDisplayType}`,hpChart.options.scales.y.min="Pre 2.5"==chartDisplayType||chartNodeNum<5?0:8e7,hpChart.options.scales.y.max="Pre 2.5"==chartDisplayType||chartNodeNum<5?7e7:24e7,hpChart.options.scales.y.ticks.stepSize="Pre 2.5"==chartDisplayType||chartNodeNum<5?5e6:1e7,hpChart.options.scales.y.grid={color:function(e){return e.tick.value%("Pre 2.5"==chartDisplayType||chartNodeNum<5?1e7:2e7)==0?"#888888":"#444444"}}}hpChart.data.labels=s,hpChart.data.datasets=[createHPDataset("Raw HP",rawHPData,"#e06666"),createHPDataset("AOE HP",aoeHPData,"#6d9eeb"),1==modeNum||2==modeNum||4==modeNum&&("Pre 2.5"==chartDisplayType?chartNodeNum>5:chartNodeNum>3)?createHPDataset("Alt HP",altHPData,"#f6b26b"):null].filter(Boolean),hpChart.update(),4==modeNum&&saveLastPage(),saveSettings()}document.addEventListener("keydown",e=>{e.stopPropagation(),e.shiftKey||e.ctrlKey||e.metaKey||e.altKey||("Escape"==e.key?(e.preventDefault(),chartIsOpen?toggleChart():versionSelectorIsOpen?toggleVersionSelector():toggleMenu()):" "!=e.key||chartIsOpen||menuIsOpen?"Backspace"!=e.key||menuIsOpen||versionSelectorIsOpen?"ArrowLeft"!=e.key||chartIsOpen||menuIsOpen||versionSelectorIsOpen?"ArrowRight"!=e.key||chartIsOpen||menuIsOpen||versionSelectorIsOpen?"ArrowUp"==e.key?(e.preventDefault(),chartIsOpen||menuIsOpen||versionSelectorIsOpen?changeChartNode(1):changeNode(1)):"ArrowDown"==e.key&&(e.preventDefault(),chartIsOpen||menuIsOpen||versionSelectorIsOpen?changeChartNode(-1):changeNode(-1)):(e.preventDefault(),changeVersion(1)):(e.preventDefault(),changeVersion(-1)):(e.preventDefault(),toggleChart()):(e.preventDefault(),toggleVersionSelector()))}),leaksToggle.addEventListener("change",()=>{leaksToggle.checked||(spoilersToggle.checked=!1,versionNum>cntNoLeaks&&(versionNum=cntNoLeaks)),showVersion()}),spoilersToggle.addEventListener("change",()=>{spoilersToggle.checked&&(leaksToggle.checked=!0),showEnemies()}),window.addEventListener("DOMContentLoaded",async()=>{await loadShiyuPage()});