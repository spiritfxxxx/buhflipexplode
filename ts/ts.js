let cntNoLeaks=1,oldModeNum=2,modeNum=2,leaksToggle=document.getElementById("lks"),spoilersToggle=document.getElementById("spl"),versionNum=null,nodeNum=null,endingNum=null,chartNodeNum=null,chartScoreNum=null,chartDisplayType=null,currNumberFormat=null,menuIsOpen=!1,versionSelectorIsOpen=!1,chartIsOpen=!1,versionData=null,enemyData=null,hpChart=null,buffNames=null,buffDescs=null,versionDazeMult=null,versionBossAnomMult=null,versionEnemyAnomMult=null,versionEnemies=null,versionIDs=[],hpData=[],nodeLvlData=[[55,58,60,65],[60,63,65,70,70,70]],nodeHPMult=[[40.8,41.58,46.04,47.74],[46.04,47.04,47.74,54.06,54.06,54.06]],nodeDefMult=[[689,751,794,794],[794,794,794,794,794,794]],nodeDazeMult=[[1.92,2,2.06,2.2],[2.06,2.2,2.35,2.35,2.35,2.35]],elementsData=["ice","fire","electric","ether","physical"];async function loadThresholdPage(){versionData=await(await fetch("ts-versions.json")).json(),enemyData=await(await fetch("../assets/enemies.json")).json(),buffDescs=await(await fetch("../assets/buffs.json")).json();for(let e=1;e<=2;++e)versionIDs.push(Object.keys(versionData[e-1].versions));buildHPData(),loadSavedState(),await showVersion(),displayHPChart(),updateNumberFormat()}async function buildHPData(){hpData=[Array.from({length:4},()=>Array.from({length:7},()=>Array.from({length:1}).fill(null))),Array.from({length:6},()=>Array.from({length:7},()=>Array.from({length:versionIDs[1].length}).fill(null)))];for(let e=1;e<=2;++e)for(let t=1;t<=versionIDs[e-1].length;++t){versionEnemies=versionData[e-1].versions[versionIDs[e-1][t-1]].versionEnemies;for(let n=1;n<=versionEnemies.nodes.length;++n){let a=versionEnemies.nodes[n-1],o=0,s=0,l=0,r=0,m=!0,i=a.sides[0].waves[0].enemies[0],d=i.id,c=enemyData[d],u=i.hp;hpData[e-1][n-1][0][t-1]=Math.ceil(.281083138*u),hpData[e-1][n-1][1][t-1]=Math.ceil(u);let p=c.tags;p.length>=1&&(1!=p.length||!p.includes("spoiler"))?p.includes("miasma")?o+=.97*u:p.includes("ucc")&&(o+=.964*u):o+=u,hpData[e-1][n-1][2][t-1]=Math.ceil(.281083138*o),hpData[e-1][n-1][3][t-1]=Math.ceil(o);for(let e=2;e<=5;++e){let t=a.sides[e-1];if(null!=t)for(let e=1;e<=t.waves.length;++e){let n=t.waves[e-1];for(let e=1;e<=n.enemies.length;++e){let t=n.enemies[e-1],a=t.id,o=enemyData[a],i=t.hp,d=o.tags;for(let e=1;e<=t.count;++e)s+="14000"!=t.id?i:1,l+=m?i:0,d.length>=1&&(1!=d.length||!d.includes("spoiler"))?d.includes("brute")?r+=.92*i:d.includes("robot")?r+=.9*i:d.includes("miasma")?r+=.85*i:d.includes("palicus")&&(r+=.75*i):r+=m?i:0,m=!1}m=!0}}hpData[e-1][n-1][4][t-1]=s,hpData[e-1][n-1][5][t-1]=l,hpData[e-1][n-1][6][t-1]=Math.ceil(r)}}}async function showVersion(){let e=versionData[modeNum-1].versions[versionIDs[modeNum-1][versionNum-1]];versionDazeMult=e.versionDazeMult,versionBossAnomMult=e.versionBossAnomMult,versionEnemyAnomMult=e.versionEnemyAnomMult,versionEnemies=e.versionEnemies,document.getElementById("v-name").innerHTML=e.versionName,document.getElementById("v-time").innerHTML=e.versionTime,showNode()}async function changeVersion(e){let t=parseInt(localStorage.getItem("lastTSVersion")),n=leaksToggle.checked?versionIDs[modeNum-1].length:cntNoLeaks;2==modeNum?versionNum=(versionNum-1+e+n)%n+1:(modeNum=2,versionNum=!leaksToggle.checked&&t>cntNoLeaks?cntNoLeaks:t),showVersion()}function showNode(){oldModeNum!=modeNum&&(nodeNum=2==modeNum?parseInt(localStorage.getItem("lastTSNode")):4,oldModeNum=modeNum,displayHPChart()),buffNames=versionEnemies.nodes[nodeNum-1].buffNames;for(let e=1;e<=4;++e)document.getElementById(`b-img${e}`).src=`../assets/buffs/${buffNames[e-1].toLowerCase().replace(" ","-")}.webp`,document.getElementById(`b-name${e}`).innerHTML=buffNames[e-1],document.getElementById(`b-desc${e}`).innerHTML=buffDescs[buffNames[e-1]];if(document.getElementById("n-text").innerHTML=`${nodeNum<4?nodeNum:4}`,showEnemies(),2==modeNum&&nodeNum>=4){document.getElementById("end").style.display="flex",document.querySelectorAll(".end-text").forEach(e=>e.classList.toggle("selected",e.dataset.format==endingNum))}else document.getElementById("end").style.display="none"}function changeNode(e){2==modeNum&&nodeNum>4&&(nodeNum=4),nodeNum=(nodeNum-1+e+4)%4+1,2==modeNum&&4==nodeNum&&(nodeNum+=endingNum-1),showNode()}function changeEnding(e){endingNum=e,nodeNum=3+e,showNode()}function showChartNode(){displayHPChart()}function changeChartNode(e){chartNodeNum=(chartNodeNum-1+e+nodeLvlData[modeNum-1].length)%nodeLvlData[modeNum-1].length+1,showChartNode()}function changeChart(){displayHPChart()}function showEnemies(){let e=versionEnemies.nodes[nodeNum-1],t=document.querySelector("#boss"),n=document.querySelector("#s1"),a=document.querySelector("#s2"),o=document.querySelector("#s3"),s=document.querySelector("#s4");t.innerHTML="",n.innerHTML="",a.innerHTML="",o.innerHTML="",s.innerHTML="";for(let l=1;l<=5;++l){let r=1==l?t:2==l?n:3==l?a:4==l?o:s,m=e.sides[l-1],i=null,d=document.createElement("div");d.className="s-header",d.innerHTML=`${1==l?"Final BATTLE":l<=4?"Required":"Optional"} ${nodeNum<4?nodeNum:"4"}${2!=modeNum||nodeNum<4?"":"."+(nodeNum-3)}${1!=l?"-"+(l-1):""} Lv${nodeLvlData[modeNum-1][nodeNum-1]}`;let c=document.createElement("div");if(c.className="s-hp-daze-anom-mult",c.innerHTML='HP: <span style="color:#ff5555;">N/A</span> | Daze: <span style="color:#ffe599;">N/A</span>',d.appendChild(c),l>=2){let t=document.createElement("div");t.className="wr",generateWR(null!=m?e.sides[l-1].sideElementMult:[1,1,1,1,1],t),d.appendChild(t)}if(r.appendChild(d),null!=m)for(let e=m.waves.length;e>=1;--e){let n=document.createElement("div");if(n.className="w",l>=2){let t=document.createElement("div");t.className="w-num",t.innerHTML=`WAVE ${e}`,n.appendChild(t)}let a=m.waves[e-1],o=document.createElement("div");o.className="w-e";for(let e=1;e<=a.enemies.length;++e){let n=a.enemies[e-1],s=n.id,m=n.type,d=enemyData[s],u=d.tags,p=d.mods,h=spoilersToggle.checked||!u.includes("spoiler"),g=h?d.name:l>=2?"SPOILER ENEMY":"SPOILER BOSS",N=h?`../assets/enemies/${d.image}.webp`:"../assets/enemies/doppelganger-i.webp",f=n.hp,y=Math.round(f/d.baseHP[m]/nodeHPMult[modeNum-1][nodeNum-1]*1e4)/100,b=d.baseDef/50*nodeDefMult[modeNum-1][nodeNum-1],v=("3"==s[2]?d.baseDaze:d.baseDaze[m])*nodeDazeMult[modeNum-1][nodeNum-1],D=d.stunMult,E=d.stunTime,I=d.baseAnom,S=d.elementMult;null==i&&(c.innerHTML=`HP: <span style="color:#ff5555;">${1==l?"SOON™":`${y}%`}</span> | Daze: <span style="color:#ffe599;">${versionDazeMult}%</span>${1==l?` | Anom: <span style="color:#7e50bb;">${versionBossAnomMult}%</span>`:""}`,"10213"==s&&1!=a.enemies.length||(i=y));for(let e=1;e<=n.count;++e){let e=document.createElement("div");e.className="e";let n=document.createElement("img"),a=document.createElement("div"),c=document.createElement("div");n.className="e-img",l>=2&&(n.style.height="108px",a.style.fontSize="12px",c.style.maxHeight="108px"),a.className="e-name",c.className="e-hover",n.src=N,c.appendChild(n),a.innerHTML=g,c.appendChild(a),e.appendChild(c);let h=document.createElement("div");h.className="wr",generateWR(S,h,l),e.appendChild(h);let T=document.createElement("div");if(T.className="e-hp",T.innerHTML=numberFormat(f),u.length>=1&&(1!=u.length||!u.includes("spoiler"))){let e=document.createElement("div");e.className="tt-e-hp",l>=2&&(e.style.fontSize="36px",e.style.top="-22px",e.style.right="89px"),u.includes("ucc")?e.innerHTML=`<span style="color:#ecce45;">✦</span><span class="tt-text">${instant("#ecce45","IMPAIRED!!",g,f,1.2,3)}</span>`:u.includes("brute")?e.innerHTML=`<span style="color:#ecce45;">✦</span><span class="tt-text">${instant("#ecce45","IMPAIRED!!",g,f,8,1)}</span>`:u.includes("robot")?e.innerHTML=`<span style="color:#ecce45;">✦</span><span class="tt-text">${instant("#ecce45","IMPAIRED!!",g,f,5,2)}</span>`:u.includes("miasma")?e.innerHTML=`<span style="color:#d4317b;">✦</span><span class="tt-text">${instant("#d4317b","PURIFIED!!",g,f,"4"==s[2]?3:15,1)}</span>`:u.includes("palicus")&&(e.innerHTML=`<span style="color:#93c47d;">✦</span><span class="tt-text">${palicus(f)}</span>`),T.appendChild(e)}if(e.appendChild(T),Math.abs(i-y)>1){let t=document.createElement("div");t.className="e-hp-mult",t.innerHTML=`[${y}%]`,e.appendChild(t)}let M=document.createElement("div");M.className="e-def",M.innerHTML=Math.ceil(b),e.appendChild(M);let w=document.createElement("div");if(w.className="tt-e-stat",w.innerHTML=`+</span><span class="tt-text">${generateEnemyStats(v,D,E,("3"==s[2]?versionBossAnomMult:versionEnemyAnomMult)/100*I,S,p)}</span>`,e.appendChild(w),o.appendChild(e),r==t&&"3"==s[2]){document.querySelector(".esd")?.remove();let e=document.createElement("div");e.className="esd",e.innerHTML=`${d.desc[m]}<br><br>${d.perf[m]}\n${1==m||0==m&&"14403"==s&&4==versionNum?`<br><br>${d.misc}`:""}`,u.includes("spoiler")&&!spoilersToggle.checked&&(e.innerHTML=`${d.spoilerDesc}<br><br>${d.spoilerPerf}`),t.parentElement.appendChild(e)}}}n.appendChild(o),r.appendChild(n)}}document.getElementById("n-hp-b-raw-20000").innerHTML=numberFormat(hpData[modeNum-1][nodeNum-1][0][versionNum-1]),document.getElementById("n-hp-b-raw-60000").innerHTML=numberFormat(hpData[modeNum-1][nodeNum-1][1][versionNum-1]),document.getElementById("n-hp-b-alt-20000").innerHTML=numberFormat(hpData[modeNum-1][nodeNum-1][2][versionNum-1]),document.getElementById("n-hp-b-alt-60000").innerHTML=numberFormat(hpData[modeNum-1][nodeNum-1][3][versionNum-1]),document.getElementById("n-hp-raw").innerHTML=numberFormat(hpData[modeNum-1][nodeNum-1][4][versionNum-1]),document.getElementById("n-hp-aoe").innerHTML=numberFormat(hpData[modeNum-1][nodeNum-1][5][versionNum-1]),document.getElementById("n-hp-alt").innerHTML=numberFormat(hpData[modeNum-1][nodeNum-1][6][versionNum-1]),2==modeNum&&saveLastPage(),saveSettings()}function generateWR(e,t,n){let a=document.createElement("img"),o=document.createElement("img"),s=document.createElement("img"),l=document.createElement("img");a.className="wk",o.className="wk",s.className="res",l.className="res",1==n&&(a.style.width="24px",o.style.width="24px",s.style.width="24px",l.style.width="24px"),a.src="../assets/elements/none.webp",o.src="../assets/elements/none.webp",s.src="../assets/elements/none.webp",l.src="../assets/elements/none.webp";let r=0,m=0;for(let t=0;t<5;++t)e[t]<1&&0==r?(a.src=`../assets/elements/${elementsData[t]}.webp`,++r):e[t]<1&&1==r?o.src=`../assets/elements/${elementsData[t]}.webp`:e[t]>1&&0==m?(s.src=`../assets/elements/${elementsData[t]}.webp`,++m):e[t]>1&&1==m&&(l.src=`../assets/elements/${elementsData[t]}.webp`);t.appendChild(a),t.appendChild(o),t.appendChild(s),t.appendChild(l)}function palicus(e){return`<span style="font-weight:bold;text-decoration:underline;">Palicus</span><br>\N<span style="color:#f6b26b;font-weight:bold;">Alt HP</span>: <span style="color:#93c47d;font-weight:bold;">${numberFormat(Math.ceil(75*e/100))}</span> x2<br>\n<span style="font-weight:bold;">(assume 75% of HP)</span><br><br>\nhit both 50% of the time<br>`}function instant(e,t,n,a,o,s){return`<span style="font-weight:bold;text-decoration:underline;">${n}</span><br>\n<span style="color:#f6b26b;font-weight:bold;">Alt HP</span>: <span style="color:${e};font-weight:bold;">${numberFormat(Math.ceil(a*(100-o*s)/100))}</span><br>\n<span style="font-weight:bold;">(assume ${100-o*s}% of HP)</span><br><br>\n<span style="font-weight:bold;"><span style="color:${e};">${t}</span></span> ${s} time(s)`+("Unknown Corruption Complex"==n?" on<br>legs, 3 time(s) on core":"")}function generateEnemyStats(e,t,n,a,o,s){let l=[1,1,1,1,1.2],r=["#98eff0","#ff5521","#2eb6ff","#fe437e","#f0d12b"],m=`<span style="font-weight:bold;">Max Daze: <span style="color:#ffe599;">${Math.round(1e4*e)/1e4}</span></span><br>\n(<span style="color:#ffe599;font-weight:bold;">${t}%</span> DMG for <span style="color:#ffe599;font-weight:bold;">${n}s</span>)<br><br>`;if(s.includes("no-anom"))return m+'<span style="font-weight:bold;">IMMUNE TO ANOMALY</span>';m+='<span style="font-weight:bold;">Max Anomaly Buildup:</span><br>';for(let e=0;e<5;++e)m+=`<span style="color:${r[e]};font-weight:bold;">${Math.round(a*l[e]*o[e]*100)/100}</span>/`;return m=m.slice(0,-1)+"<br>"+(s.includes("no-freeze")?'<span style="color:#98eff0;font-weight:bold;">UNFREEZABLE</span>':""),m}function loadSavedState(){"true"==localStorage.getItem("leaksEnabled")&&(leaksToggle.checked=!0),"true"==localStorage.getItem("spoilersEnabled")&&(spoilersToggle.checked=!0),versionNum=parseInt(localStorage.getItem("lastTSVersion")||`${cntNoLeaks}`),nodeNum=parseInt(localStorage.getItem("lastTSNode")||"6"),endingNum=parseInt(localStorage.getItem("lastTSEnding")||"3"),chartNodeNum=parseInt(localStorage.getItem("lastTSChartNode")||"6"),chartScoreNum=localStorage.getItem("lastTSChartScore")||"60k",chartDisplayType=localStorage.getItem("lastTSChartType")||"Boss",currNumberFormat=localStorage.getItem("numberFormat")||"period",leaksToggle.checked||(versionNum=Math.min(versionNum,cntNoLeaks)),saveLastPage(),saveSettings()}function saveLastPage(){localStorage.setItem("lastTSVersion",versionNum),localStorage.setItem("lastTSNode",nodeNum),localStorage.setItem("lastTSEnding",endingNum),localStorage.setItem("lastTSChartNode",chartNodeNum),localStorage.setItem("lastTSChartType",chartDisplayType)}function saveSettings(){localStorage.setItem("lastTSChartScore",chartScoreNum),localStorage.setItem("numberFormat",currNumberFormat),localStorage.setItem("leaksEnabled",leaksToggle.checked),localStorage.setItem("spoilersEnabled",spoilersToggle.checked)}function toggleMenu(){let e=document.getElementById("mb"),t=document.getElementById("mb-o"),n=document.getElementById("open-mb-btn");menuIsOpen?(document.body.classList.remove("no-scroll"),e.style.display="none",t.style.display="none",n.style.display="none"):(document.body.classList.add("no-scroll"),e.style.display="block",t.style.display="block",n.style.display="block"),menuIsOpen=!menuIsOpen}function updateNumberFormat(e){e&&(currNumberFormat=e.dataset.format);let t=document.getElementById("ex-num"),n=document.querySelectorAll(".nfb");t.innerHTML=numberFormat(2222222),n.forEach(e=>e.classList.toggle("selected",e.dataset.format==currNumberFormat)),showEnemies(),displayHPChart()}function numberFormat(e){return"comma"==currNumberFormat?e.toLocaleString("en-US"):"period"==currNumberFormat?e.toLocaleString("de-DE"):e}function toggleVersionSelector(){let e=document.getElementById("vs"),t=document.getElementById("vs-o");versionSelectorIsOpen?(document.body.classList.remove("no-scroll"),e.style.display="none",t.style.display="none"):(document.body.classList.add("no-scroll"),e.style.display="flex",t.style.display="block",displayVersionSelectorGrid()),versionSelectorIsOpen=!versionSelectorIsOpen}function displayVersionSelectorGrid(){let e=document.getElementById("vs"),t=e.querySelector("#vg"),n=e.querySelector("#vg-row1"),a=e.querySelector("#vg-title"),o=e.querySelector("#vg-row2");n.innerHTML="",a.innerHTML="Hard Mode",o.innerHTML="";for(let e=1;e<=2;++e)for(let t=1;t<=(2==e?leaksToggle.checked?versionIDs[e-1].length:cntNoLeaks:1);++t){let a=versionData[e-1].versions[versionIDs[e-1][t-1]],s=document.createElement("div"),l=document.createElement("div"),r=document.createElement("div");s.className="vg-c",l.className="vg-c-name",r.className="vg-c-time",l.innerHTML=a.versionName,r.innerHTML=a.versionTime,s.appendChild(l),s.appendChild(r),s.onclick=()=>{modeNum=e,versionNum=2==modeNum?t:1,toggleVersionSelector(),showVersion()},2!=e?n.appendChild(s):o.appendChild(s)}t.appendChild(n),t.appendChild(a),t.appendChild(o)}function toggleChart(){let e=document.getElementById("c");chartIsOpen?(document.body.classList.remove("no-scroll"),e.style.display="none"):(document.body.classList.add("no-scroll"),e.style.display="flex"),chartIsOpen=!chartIsOpen}function toggleChartPoints(e){chartScoreNum!=e&&(chartScoreNum=e,saveSettings(),displayHPChart())}function downloadChart(){let e=document.createElement("a");e.href=hpChart.toBase64Image("image/png",1),e.download=`Threshold Simulation - ${versionData[modeNum-1].name} ${chartNodeNum<4?chartNodeNum:"4"}${2!=modeNum||chartNodeNum<4?"":"-"+(chartNodeNum-3)} ${chartDisplayType} HP (${chartScoreNum})`,e.click()}function createHPDataset(e,t,n){return{label:e,data:t,pointRadius:2,borderWidth:2,borderColor:n,pointHoverRadius:4,pointHoverBorderWidth:2,pointHoverBorderColor:n,backgroundColor:"#ffffff"}}function displayHPChart(){chartDisplayType=document.getElementById("c-dd").value,document.querySelectorAll(".c-k").forEach(e=>{e.style.display="Boss"==chartDisplayType?"block":"none"}),document.querySelectorAll(".c-k").forEach(e=>e.classList.toggle("selected",e.dataset.format==chartScoreNum));const e={id:"verticalHoverLine",beforeDatasetsDraw(e,t,n){let{ctx:a,chartArea:{top:o,bottom:s,height:l}}=e;a.save();for(let t=0;t<=2;++t)e.getDatasetMeta(t).data.forEach((e,t)=>{e.active&&(a.beginPath(),a.strokeStyle="#888888",a.setLineDash([4,6]),a.moveTo(e.x,o),a.lineTo(e.x,s),a.stroke())});a.restore()}},t={id:"legendPadding",beforeInit(e){let t=e.legend.fit;e.legend.fit=function(){t.bind(e.legend)(),e.legend.height+=15}}},n={id:"hideTooltipOutside",afterEvent(e,t){let{top:n,bottom:a,left:o,right:s}=e.chartArea,{x:l,y:r}=t.event;(l<o||l>s||r<n||r>a)&&(e.tooltip.setActiveElements([]),e.tooltip.update(),e.setActiveElements([]),e.update())}};var a;Chart.Tooltip.positioners.cursor=function(e,t){if(!t)return!1;let{top:n,bottom:a}=this.chart.chartArea,{x:o,y:s}=t;return s+=s<=(n+a)/3?50:-50,{x:o,y:s}},hpChart||(hpChart=new Chart("hpChart",{type:"line",plugins:[e,t,n],options:{animation:!1,responsive:!0,maintainAspectRatio:!1,interaction:{mode:"nearest",axis:"x",intersect:!1},layout:{padding:{top:10,bottom:15,left:10,right:25}},scales:{x:{offset:!0,border:{display:!1},grid:{color:"transparent"},ticks:{padding:10,font:{family:"Inconsolata",size:12},color:"#888888",maxRotation:0,callback:function(e,t){return t%2==0?this.getLabelForValue(e):""}}},y:{border:{display:!1},grid:{color:function(e){return e.tick.value%4e7==0?"#888888":"#444444"}},ticks:{padding:15,font:{family:"Inconsolata",size:12},color:"#888888",stepSize:2e7,callback:function(e,t){return t%2==0?numberFormat(e):""}}}},plugins:{title:{display:!0,color:"#ffffff",font:{family:"Inconsolata",size:20,weight:"bold"}},legend:{labels:{usePointStyle:!0,boxHeight:8,font:{family:"Inconsolata",size:14},generateLabels:function(e){let t=Chart.defaults.plugins.legend.labels.generateLabels(e);return t.forEach((t,n)=>{e.isDatasetVisible(n)?t.fontColor=e.data.datasets[t.datasetIndex].borderColor:(t.fontColor="#888888",t.strokeStyle="#888888")}),t}}},tooltip:{usePointStyle:!0,boxHeight:8,position:"cursor",caretSize:0,titleFont:{family:"Inconsolata",size:12,weight:"bold",lineHeight:.75},bodyFont:{family:"Inconsolata",size:12},callbacks:{labelTextColor:function(e){return e.dataset.borderColor},label:function(e){return e.dataset.label+": "+numberFormat(e.parsed.y)}}}}}})),document.getElementById("c-dd").value=chartDisplayType;let o=[],s=[],l=[],r=[],m=[];if(2!=modeNum){a=Array.from({length:nodeLvlData[modeNum-1].length},(e,t)=>`${versionData[modeNum-1].name} ${t+1}`);for(let e=0;e<nodeLvlData[modeNum-1].length;++e)o.push("20k"==chartScoreNum?hpData[modeNum-1][e][0][0]:hpData[modeNum-1][e][1][0]),s.push("20k"==chartScoreNum?hpData[modeNum-1][e][2][0]:hpData[modeNum-1][e][3][0]),l.push(hpData[modeNum-1][e][4][0]),r.push(hpData[modeNum-1][e][5][0]),m.push(hpData[modeNum-1][e][6][0]);hpChart.options.plugins.title.text=`Threshold Simulation: Easy Mode ${chartDisplayType} HP`,hpChart.options.scales.y.min=0,hpChart.options.scales.y.max="20k"==chartScoreNum?4e7:12e7}else a=versionIDs[modeNum-1],o="20k"==chartScoreNum?hpData[modeNum-1][chartNodeNum-1][0]:hpData[modeNum-1][chartNodeNum-1][1],s="20k"==chartScoreNum?hpData[modeNum-1][chartNodeNum-1][2]:hpData[modeNum-1][chartNodeNum-1][3],l=hpData[modeNum-1][chartNodeNum-1][4],r=hpData[modeNum-1][chartNodeNum-1][5],m=hpData[modeNum-1][chartNodeNum-1][6],hpChart.options.plugins.title.text=`Threshold Simulation: Hard Mode ${chartNodeNum<4?chartNodeNum:"4"}${2!=modeNum||chartNodeNum<4?"":"."+(chartNodeNum-3)} ${chartDisplayType} HP${"Boss"==chartDisplayType?` (${chartScoreNum})`:""}`,hpChart.options.scales.y.min="Enemy"==chartDisplayType||"20k"==chartScoreNum?0:8e7,hpChart.options.scales.y.max="Enemy"==chartDisplayType?16e7:"20k"==chartScoreNum?12e7:4e8;hpChart.data.labels=a,hpChart.data.datasets="Boss"==chartDisplayType?[createHPDataset("Raw HP",o,"#e06666"),createHPDataset("Alt HP",s,"#f6b26b")]:[createHPDataset("Raw HP",l,"#e06666"),createHPDataset("AOE HP",r,"#6d9eeb"),createHPDataset("Alt HP",m,"#f6b26b")],hpChart.update(),2==modeNum&&saveLastPage(),saveSettings()}document.addEventListener("keydown",e=>{e.stopPropagation(),"Escape"==e.key?(e.preventDefault(),chartIsOpen?toggleChart():versionSelectorIsOpen?toggleVersionSelector():toggleMenu()):" "!=e.key||menuIsOpen||chartIsOpen?"Backspace"!=e.key||menuIsOpen||versionSelectorIsOpen?"ArrowLeft"!=e.key||menuIsOpen||chartIsOpen||versionSelectorIsOpen?"ArrowRight"!=e.key||menuIsOpen||chartIsOpen||versionSelectorIsOpen?"ArrowUp"==e.key?(e.preventDefault(),menuIsOpen||chartIsOpen||versionSelectorIsOpen?changeChartNode(1):changeNode(1)):"ArrowDown"==e.key&&(e.preventDefault(),menuIsOpen||chartIsOpen||versionSelectorIsOpen?changeChartNode(-1):changeNode(-1)):(e.preventDefault(),changeVersion(1)):(e.preventDefault(),changeVersion(-1)):(e.preventDefault(),toggleChart()):(e.preventDefault(),toggleVersionSelector())}),leaksToggle.addEventListener("change",()=>{leaksToggle.checked||(spoilersToggle.checked=!1,versionNum>cntNoLeaks&&(versionNum=cntNoLeaks)),showVersion()}),spoilersToggle.addEventListener("change",()=>{spoilersToggle.checked&&(leaksToggle.checked=!0),showEnemies()}),window.addEventListener("DOMContentLoaded",async()=>{await loadThresholdPage()});